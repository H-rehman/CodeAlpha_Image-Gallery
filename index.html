<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <link rel="stylesheet" href="stlyle.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Image Gallery</h1>
            <p class="subtitle">A responsive gallery with lightbox view and filtering</p>
        </header>

        <div class="filter-controls">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="nature">Nature</button>
            <button class="filter-btn" data-filter="architecture">Architecture</button>
            <button class="filter-btn" data-filter="technology">Technology</button>
        </div>

        <div class="gallery" id="gallery">
            <!-- Gallery items will be generated by JavaScript -->
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <span class="lightbox-close" id="lightbox-close">&times;</span>
        <div class="lightbox-nav">
            <button class="lightbox-btn" id="prev-btn">&#10094;</button>
            <button class="lightbox-btn" id="next-btn">&#10095;</button>
        </div>
        <div class="lightbox-content">
            <img class="lightbox-img" id="lightbox-img" src="" alt="">
            <div class="lightbox-caption" id="lightbox-caption"></div>
        </div>
    </div>

    <script>

        // Placeholder local filenames (drop your originals into the images/ folder and keep the same names)
        // Loader will show sample SVGs as fallbacks if these files are not present yet.
        const images = [
            { src: 'images/image1.jpg', category: 'nature', caption: 'Image 1' },
            { src: 'images/image2.jpg', category: 'nature', caption: 'Image 2' },
            { src: 'images/image3.jpg', category: 'nature', caption: 'Image 3' },
            { src: 'images/image4.jpg', category: 'architecture', caption: 'Image 4' },
            { src: 'images/image5.jpg', category: 'architecture', caption: 'Image 5' },
            { src: 'images/image6.jpg', category: 'architecture', caption: 'Image 6' },
            { src: 'images/image7.jpg', category: 'technology', caption: 'Image 7' },
            { src: 'images/image8.jpg', category: 'technology', caption: 'Image 8' },
            { src: 'images/image9.jpg', category: 'technology', caption: 'Image 9' },
            { src: 'images/image10.jpg', category: 'nature', caption: 'Image 10' },
            { src: 'images/image11.jpg', category: 'architecture', caption: 'Image 11' },
            { src: 'images/image12.jpg', category: 'technology', caption: 'Image 12' }
            ];

        // DOM Elements
        const gallery = document.getElementById('gallery');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxCaption = document.getElementById('lightbox-caption');
        const lightboxClose = document.getElementById('lightbox-close');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const filterBtns = document.querySelectorAll('.filter-btn');

        let currentImageIndex = 0;
        let filteredImages = [...images];

        // Initialize gallery
        function initGallery() {
            renderGallery();
            setupEventListeners();
        }

        // Known-good fallback images (direct images from images.unsplash.com)
        const fallbackImages = [
            'images/sample1.svg',
            'images/sample2.svg',
            'images/sample3.svg'
        ];

        // Render gallery items (programmatic creation to allow retries/fallbacks)
        function renderGallery() {
            gallery.innerHTML = '';

            filteredImages.forEach((image, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.dataset.category = image.category;

                const imgEl = document.createElement('img');
                imgEl.alt = image.caption || '';

                // Retry logic for unreliable endpoints like source.unsplash.com/random
                let attempts = 0;
                const maxAttempts = 3;

                function tryLoad(src) {
                    const sep = src.includes('?') ? '&' : '?';
                    imgEl.src = src + sep + 'cb=' + Date.now();
                }

                imgEl.onload = () => {
                    imgEl.dataset.loadedSrc = imgEl.src;
                };

                imgEl.onerror = () => {
                    attempts++;
                    console.warn('Image load error for', image.src, 'attempt', attempts);
                    if (attempts < maxAttempts) {
                        tryLoad(image.src);
                    } else {
                        const fallback = fallbackImages[index % fallbackImages.length];
                        console.warn('Using fallback image for', image.src, '->', fallback);
                        imgEl.onerror = null;
                        imgEl.src = fallback + '&cb=' + Date.now();
                        imgEl.dataset.loadedSrc = imgEl.src;
                    }
                };

                // Start loading
                tryLoad(image.src);

                const caption = document.createElement('div');
                caption.className = 'image-caption';
                caption.textContent = image.caption || '';

                galleryItem.appendChild(imgEl);
                galleryItem.appendChild(caption);

                galleryItem.addEventListener('click', () => {
                    const actual = imgEl.dataset.loadedSrc || imgEl.src || image.src;
                    openLightboxWithSrc(index, actual, image.caption);
                });

                gallery.appendChild(galleryItem);
            });
        }

        // Open lightbox using the actual loaded src (used by programmatic gallery items)
        function openLightboxWithSrc(index, src, caption) {
            currentImageIndex = index;
            lightboxImg.src = src;
            lightboxCaption.textContent = caption || '';
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter buttons
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const filter = btn.dataset.filter;
                    filterImages(filter);
                    
                    // Update active button
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
            
            // Lightbox controls
            lightboxClose.addEventListener('click', closeLightbox);
            prevBtn.addEventListener('click', showPrevImage);
            nextBtn.addEventListener('click', showNextImage);
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (lightbox.classList.contains('active')) {
                    if (e.key === 'Escape') closeLightbox();
                    if (e.key === 'ArrowLeft') showPrevImage();
                    if (e.key === 'ArrowRight') showNextImage();
                }
            });
            
            // Close lightbox when clicking outside the image
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });
        }

        // Filter images by category
        function filterImages(category) {
            if (category === 'all') {
                filteredImages = [...images];
            } else {
                filteredImages = images.filter(image => image.category === category);
            }
            renderGallery();
        }

        // Open lightbox with selected image
        function openLightbox(index) {
            currentImageIndex = index;
            updateLightbox();
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        // Close lightbox
        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = ''; // Re-enable scrolling
        }

        // Show previous image in lightbox
        function showPrevImage() {
            currentImageIndex = (currentImageIndex - 1 + filteredImages.length) % filteredImages.length;
            updateLightbox();
        }

        // Show next image in lightbox
        function showNextImage() {
            currentImageIndex = (currentImageIndex + 1) % filteredImages.length;
            updateLightbox();
        }

        // Update lightbox content
        function updateLightbox() {
            const image = filteredImages[currentImageIndex];
            lightboxImg.src = image.src;
            lightboxCaption.textContent = image.caption;
        }

        // Initialize the gallery when page loads
        document.addEventListener('DOMContentLoaded', initGallery);
    </script>
</body>
</html>